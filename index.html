<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>多言語例文クイズ / Multi-Language-Sentence Quiz</title>
  <style>
    select, button { margin: 5px; }
    .question-block { margin-bottom: 30px; }
  </style>
</head>
<body>
  <h2>多言語例文クイズ / Multi-Language-Sentence Quiz</h2>

  <label for="grammarSelect">文法項目を選ぶ / Choose a section:</label>
  <select id="grammarSelect"></select>

  <br>
  <label for="questionLang">出題言語を選ぶ / Choose a language for question:</label>
  <select id="questionLang"></select>

  <br>
  <label for="answerLang">解答言語を選ぶ / Choose a language for answer:</label>
  <select id="answerLang"></select>

  <br>
  <button onclick="showQuestions()">問題を表示 / Generate questions</button>
  <button onclick="showAnswers()">解答を表示 / Check answers</button>

  <div id="output"></div>

  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0Iem_yxNPZtbeCjIal25VKCtGzcLprs_qSnf4peu5n0FPB0PBgBNyqCmwXekd9dvBtanJAI8Ihq4b/pub?gid=0&single=true&output=csv';

    let data = [];
    let headers = [];

    async function loadData() {
      const res = await fetch(sheetUrl);
      const text = await res.text();
      const rows = text.trim().split('\n').map(row => row.split(','));
      headers = rows[0].slice(2); // C列以降を言語名として取得
      data = rows.slice(1);

      const grammarSet = [...new Set(data.map(row => row[0]))];
      grammarSet.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item;
        opt.textContent = item;
        document.getElementById('grammarSelect').appendChild(opt);
      });

      headers.forEach(lang => {
        const opt1 = document.createElement('option');
        const opt2 = document.createElement('option');
        opt1.value = lang;
        opt1.textContent = lang;
        opt2.value = lang;
        opt2.textContent = lang;
        document.getElementById('questionLang').appendChild(opt1);
        document.getElementById('answerLang').appendChild(opt2);
      });
    }

    function showQuestions() {
      const grammar = document.getElementById('grammarSelect').value;
      const qLang = document.getElementById('questionLang').value;
      const output = document.getElementById('output');
      output.innerHTML = '';
      const qIndex = headers.indexOf(qLang) + 2; // C列以降なので+2
      const filtered = data.filter(row => row[0] === grammar);
      filtered.forEach((row, i) => {
        const div = document.createElement('div');
        div.className = 'question-block';
        div.innerHTML = `<strong>(${i + 1})</strong> ${row[qIndex]}`;
        output.appendChild(div);
      });
    }

    function showAnswers() {
      const grammar = document.getElementById('grammarSelect').value;
      const qLang = document.getElementById('questionLang').value;
      const aLang = document.getElementById('answerLang').value;
      const output = document.getElementById('output');
      const qIndex = headers.indexOf(qLang) + 2;
      const aIndex = headers.indexOf(aLang) + 2;
      const filtered = data.filter(row => row[0] === grammar);

      Array.from(output.children).forEach((block, i) => {
        const aText = filtered[i][aIndex];
        const qLangCode = convertLang(qLang);
        const aLangCode = convertLang(aLang);
        const grammarNum = grammar.split('_')[0];
        const numStr = String(i + 1).padStart(3, '0');
        const qAudio = `<audio controls src="audio/${grammarNum}_${qLangCode}_${numStr}.mp3"></audio>`;
        const aAudio = `<audio controls src="audio/${grammarNum}_${aLangCode}_${numStr}.mp3"></audio>`;
        block.innerHTML += `<br>${aText}<br>${qAudio}<br>${aAudio}`;
      });
    }

    function convertLang(name) {
      const map = {
        'English': 'en', '日本語': 'ja', 'Tiếng Việt': 'vi', '汉语': 'zh', 'Bahasa Indonesia': 'id',
        'ภาษาไทย': 'th', 'မြန်မာစာ': 'my', '韓国語': 'ko', 'اردو': 'ur', '廣東話': 'yue',
        'हिन्दी': 'hi', 'Le français': 'fr', 'Português': 'pt'
      };
      return map[name] || 'xx';
    }

    window.onload = loadData;
  </script>
</body>
</html>
